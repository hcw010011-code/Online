<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ í‹±íƒí†  ì˜¨ë¼ì¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        // ì‚¬ìš©ìê°€ ì œê³µí•œ Firebase ì„¤ì • (Screenshot 12:34 ê¸°ì¤€)
        const firebaseConfig = {
            apiKey: "AIzaSyAWtdYncScCZgMJiy1SZRq1eOylmby5syI",
            authDomain: "tictactoe-a7f97.firebaseapp.com",
            projectId: "tictactoe-a7f97",
            storageBucket: "tictactoe-a7f97.firebasestorage.app",
            messagingSenderId: "113959866370",
            appId: "1:113959866370:web:7e45128e24e2b3834ed71b",
            measurementId: "G-P1MXHFQZYT"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let roomId = "";
        let myMark = ""; 
        let currentBoard = Array(9).fill("");
        let currentTurn = "X";
        let unsub = null;

        // ìµëª… ì¸ì¦ ì‹¤í–‰
        signInAnonymously(auth).catch(err => {
            console.error("ì¸ì¦ ì‹¤íŒ¨: Authentication ë©”ë‰´ì—ì„œ ìµëª… ë¡œê·¸ì¸ì„ ì¼œì£¼ì„¸ìš”.", err);
        });

        window.createRandomRoom = () => {
            const randomId = Math.floor(1000 + Math.random() * 9000).toString();
            document.getElementById('roomInput').value = randomId;
            window.joinRoom();
        };

        window.joinRoom = async () => {
            const inputId = document.getElementById('roomInput').value.trim();
            if (!inputId) return alert("ë°© ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");

            roomId = inputId;
            const roomRef = doc(db, "rooms", roomId);
            
            try {
                const roomSnap = await getDoc(roomRef);
                if (!roomSnap.exists()) {
                    myMark = "X";
                    await setDoc(roomRef, { board: Array(9).fill(""), turn: "X", winner: "" });
                } else {
                    if (!myMark) myMark = "O";
                }

                if (unsub) unsub();
                unsub = onSnapshot(roomRef, (snap) => {
                    const data = snap.data();
                    if (!data) return;
                    renderBoard(data.board);
                    currentBoard = data.board;
                    currentTurn = data.turn;
                    updateStatus(data);
                });

                document.getElementById('lobby').classList.add('hidden');
                document.getElementById('game-area').classList.remove('hidden');
            } catch (error) {
                alert("ì—°ê²° ì‹¤íŒ¨! ê·œì¹™ ê²Œì‹œ í™•ì¸ ë° ìµëª… ë¡œê·¸ì¸ì„ í™œì„±í™”í•˜ì„¸ìš”.");
            }
        };

        function renderBoard(board) {
            board.forEach((val, i) => {
                const cell = document.getElementById(`cell-${i}`);
                if (val && cell.innerHTML === "") {
                    cell.innerHTML = val === 'X' ? getXSVG() : getOSVG();
                } else if (!val) { cell.innerHTML = ""; }
            });
        }

        function updateStatus(data) {
            const status = document.getElementById('status');
            const info = document.getElementById('info');
            info.innerText = `ë°© ID: ${roomId} | ë‚´ ê¸°í˜¸: ${myMark}`;
            if (data.winner) {
                status.innerText = data.winner === 'Draw' ? "ë¬´ìŠ¹ë¶€!" : `${data.winner} ìŠ¹ë¦¬!`;
                status.className = "text-3xl font-bold text-yellow-400 mb-6";
            } else {
                const isMyTurn = (data.turn === myMark);
                status.innerText = isMyTurn ? "ğŸ”¥ ë‚´ ì°¨ë¡€ì…ë‹ˆë‹¤!" : "âŒ› ìƒëŒ€ë°© ëŒ€ê¸° ì¤‘...";
                status.className = `text-xl mb-6 font-bold ${isMyTurn ? 'text-blue-400' : 'text-gray-500'}`;
            }
        }

        window.makeMove = async (i) => {
            if (currentBoard[i] !== "" || currentTurn !== myMark || checkWinner(currentBoard)) return;
            const newBoard = [...currentBoard];
            newBoard[i] = myMark;
            const winner = checkWinner(newBoard);
            await updateDoc(doc(db, "rooms", roomId), { board: newBoard, turn: myMark === "X" ? "O" : "X", winner: winner || "" });
        };

        function checkWinner(b) {
            const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            for (let [a,b_idx,c] of lines) { if (b[a] && b[a] === b[b_idx] && b[a] === b[c]) return b[a]; }
            return !b.includes("") ? "Draw" : null;
        }

        window.resetGame = async () => {
            await updateDoc(doc(db, "rooms", roomId), { board: Array(9).fill(""), turn: "X", winner: "" });
        };

        function getXSVG() { return `<svg class="w-16 h-16" viewBox="0 0 100 100"><path d="M25 25 L75 75" stroke="#60a5fa" stroke-width="10" stroke-linecap="round" fill="none" class="draw-path"/><path d="M75 25 L25 75" stroke="#60a5fa" stroke-width="10" stroke-linecap="round" fill="none" class="draw-path" style="animation-delay:0.2s"/></svg>`; }
        function getOSVG() { return `<svg class="w-16 h-16" viewBox="0 0 100 100"><circle cx="50" cy="50" r="30" stroke="#f87171" stroke-width="10" stroke-linecap="round" fill="none" class="draw-circle"/></svg>`; }
    </script>
    <style>
        @keyframes draw { to { stroke-dashoffset: 0; } }
        .draw-path { stroke-dasharray: 100; stroke-dashoffset: 100; animation: draw 0.3s forwards; }
        .draw-circle { stroke-dasharray: 200; stroke-dashoffset: 200; animation: draw 0.5s forwards; }
        body { background: #0f172a; color: white; display: flex; align-items: center; justify-content: center; min-h-screen; font-family: sans-serif; }
    </style>
</head>
<body>
    <div id="lobby" class="bg-gray-900 p-8 rounded-3xl border border-white/10 text-center w-80 shadow-2xl">
        <h1 class="text-3xl font-black mb-6 tracking-tighter">TIC TAC TOE</h1>
        <input id="roomInput" type="text" placeholder="ë°© ë²ˆí˜¸" class="w-full bg-black border border-gray-700 rounded-xl px-4 py-3 mb-4 text-center text-xl font-bold text-white outline-none">
        <button onclick="joinRoom()" class="w-full bg-blue-600 py-4 rounded-xl font-bold mb-2 active:scale-95 transition">ì…ì¥</button>
        <button onclick="createRandomRoom()" class="w-full bg-gray-800 py-2 rounded-xl text-xs text-gray-400">ëœë¤ ìƒì„±</button>
    </div>
    <div id="game-area" class="hidden text-center w-80">
        <div id="info" class="text-[10px] text-gray-500 mb-2 font-mono"></div>
        <div id="status"></div>
        <div class="grid grid-cols-3 gap-3 bg-white/5 p-3 rounded-3xl border border-white/10">
            <div id="cell-0" onclick="makeMove(0)" class="aspect-square flex items-center justify-center bg-gray-900 rounded-2xl cursor-pointer h-24"></div>
            <div id="cell-1" onclick="makeMove(1)" class="aspect-square flex items-center justify-center bg-gray-900 rounded-2xl cursor-pointer h-24"></div>
            <div id="cell-2" onclick="makeMove(2)" class="aspect-square flex items-center justify-center bg-gray-900 rounded-2xl cursor-pointer h-24"></div>
            <div id="cell-3" onclick="makeMove(3)" class="aspect-square flex items-center justify-center bg-gray-900 rounded-2xl cursor-pointer h-24"></div>
            <div id="cell-4" onclick="makeMove(4)" class="aspect-square flex items-center justify-center bg-gray-900 rounded-2xl cursor-pointer h-24"></div>
            <div id="cell-5" onclick="makeMove(5)" class="aspect-square flex items-center justify-center bg-gray-900 rounded-2xl cursor-pointer h-24"></div>
            <div id="cell-6" onclick="makeMove(6)" class="aspect-square flex items-center justify-center bg-gray-900 rounded-2xl cursor-pointer h-24"></div>
            <div id="cell-7" onclick="makeMove(7)" class="aspect-square flex items-center justify-center bg-gray-900 rounded-2xl cursor-pointer h-24"></div>
            <div id="cell-8" onclick="makeMove(8)" class="aspect-square flex items-center justify-center bg-gray-900 rounded-2xl cursor-pointer h-24"></div>
        </div>
        <button onclick="resetGame()" class="mt-8 text-gray-500 text-sm underline">ì´ˆê¸°í™”</button>
    </div>
</body>
</html>

